<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabForge | Teacher Thinh</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        :root {
            --primary: #1a237e; --secondary: #2962ff; --success: #00c853; --danger: #d50000;
            --bg-color: #f0f2f5; --text-main: #333; --sidebar-w: 250px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { display: flex; height: 100vh; background-color: var(--bg-color); color: var(--text-main); overflow: hidden; }
        
        #admin-view { display: flex; width: 100%; height: 100%; }
        .sidebar { width: var(--sidebar-w); background: #fff; border-right: 1px solid #e0e0e0; padding: 20px; display: flex; flex-direction: column; }
        .brand { font-size: 24px; font-weight: bold; color: var(--primary); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: 0.2s; color: #555; }
        .nav-item:hover, .nav-item.active { background: #e8eaf6; color: var(--primary); }
        
        .main-content { flex: 1; display: flex; flex-direction: column; padding: 20px 30px; overflow-y: auto; }
        .header { margin-bottom: 25px; }
        .header h1 { font-size: 28px; color: var(--primary); }
        .header p { color: #666; margin-top: 5px; }
        
        .view-section { display: none; flex-direction: column; height: 100%; }
        .view-section.active { display: flex; }

        .workspace { display: flex; gap: 20px; flex: 1; min-height: 0; }
        .panel { flex: 1; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow: hidden; }
        .panel-header { background: #fafafa; padding: 15px 20px; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .panel-actions { display: flex; gap: 10px; }
        
        textarea { flex: 1; width: 100%; border: none; padding: 20px; font-family: 'Consolas', monospace; font-size: 14px; color: #333; resize: none; outline: none; background: #fafafa; }
        button { border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; color: white; }
        .btn-run { background: var(--secondary); } .btn-run:hover { background: #1c44b2; }
        .btn-save { background: var(--success); } .btn-save:hover { background: #009624; }
        .btn-danger { background: var(--danger); } .btn-danger:hover { background: #9b0000; }
        iframe { width: 100%; height: 100%; border: none; background: #fff; }

        .library-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .lib-card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; height: 160px;}
        .lib-card h3 { color: var(--primary); margin-bottom: 10px; font-size: 18px; }
        .lib-card .date { font-size: 12px; color: #888; margin-bottom: 15px; }
        .lib-actions { display: flex; gap: 8px; }
        .lib-actions button { flex: 1; padding: 8px 5px; font-size: 13px; }

        .settings-card { background: #fff; padding: 25px; border-radius: 12px; max-width: 500px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; width: 90%; max-width: 800px; height: 80vh; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 15px 20px; background: #fafafa; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .btn-close { background: #ccc; color: #333; }
        
        #student-view { display: none; width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; background: #f0f2f5; z-index: 9999; }
        #student-view.active { display: block; }
        #studentFrame { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <div id="admin-view">
        <aside class="sidebar">
            <div class="brand">üéì VocabForge</div>
            <div class="nav-item active" onclick="switchTab('creator')">‚ö° Tr√¨nh T·∫°o Flashcard</div>
            <div class="nav-item" onclick="switchTab('library')">üìö Kho T·ª´ V·ª±ng</div>
            <div class="nav-item" onclick="switchTab('settings')">‚öôÔ∏è C√†i ƒê·∫∑t L·ªõp H·ªçc</div>
        </aside>

        <main class="main-content">
            <div id="view-creator" class="view-section active">
                <div class="header">
                    <h1 id="welcomeText">Workspace - T√≠ch H·ª£p Th·∫ª</h1>
                    <p>D√°n m√£ ngu·ªìn HTML/CSS/JS do h·ªá th·ªëng AI t·∫°o ra ƒë·ªÉ ch·∫°y th·ª≠ nghi·ªám ngay l·∫≠p t·ª©c.</p>
                </div>
                <div class="workspace">
                    <div class="panel">
                        <div class="panel-header">
                            <span>üíª Code Editor (D√°n HTML v√†o ƒë√¢y)</span>
                            <div class="panel-actions">
                                <button class="btn-run" onclick="renderCode()">Kh·ªüi Ch·∫°y ‚ñ∂</button>
                                <button class="btn-save" onclick="saveFlashcard()">üíæ L∆∞u v√†o Kho</button>
                            </div>
                        </div>
                        <textarea id="sourceCode" placeholder=""></textarea>
                    </div>
                    <div class="panel">
                        <div class="panel-header"><span>üì± Live Preview</span></div>
                        <iframe id="previewFrame" sandbox="allow-scripts"></iframe>
                    </div>
                </div>
            </div>

            <div id="view-library" class="view-section">
                <div class="header">
                    <h1>üìö Kho T·ª´ V·ª±ng</h1>
                </div>
                <div class="library-grid" id="libraryContainer"></div>
            </div>

            <div id="view-settings" class="view-section">
                <div class="header">
                    <h1>‚öôÔ∏è C√†i ƒê·∫∑t H·ªá Th·ªëng</h1>
                </div>
                <div class="settings-card">
                    <div class="form-group">
                        <label>T√™n Gi√°o Vi√™n (ƒê·ªãnh danh):</label>
                        <input type="text" id="teacherName" placeholder="V√≠ d·ª•: Mr. Thinh Nguyen">
                    </div>
                    <button class="btn-run" onclick="saveSettings()" style="width: 100%; margin-bottom: 20px;">C·∫≠p Nh·∫≠t Th√¥ng Tin</button>
                    <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 20px;">
                    <button class="btn-danger" onclick="clearAllData()" style="width: 100%;">C·∫£nh b√°o: X√≥a to√†n b·ªô d·ªØ li·ªáu Flashcard</button>
                </div>
            </div>
        </main>
    </div>

    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Xem Flashcard</h3>
                <button class="btn-close" onclick="closeModal()">ƒê√≥ng ‚úñ</button>
            </div>
            <iframe id="modalFrame" sandbox="allow-scripts" style="flex:1;"></iframe>
        </div>
    </div>

    <div id="student-view">
        <iframe id="studentFrame" sandbox="allow-scripts"></iframe>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const sharedCode = urlParams.get('play');

        if (sharedCode) {
            document.getElementById('admin-view').style.display = 'none';
            document.getElementById('student-view').classList.add('active');
            try {
                // Gi·∫£i n√©n m√£ HTML t·ª´ ƒë∆∞·ªùng link
                const decodedCode = LZString.decompressFromEncodedURIComponent(sharedCode);
                if (!decodedCode) throw new Error("M√£ h·ªèng");
                document.getElementById('studentFrame').srcdoc = decodedCode;
            } catch (e) {
                document.getElementById('student-view').innerHTML = '<h2 style="text-align:center; padding-top:50px; font-family:sans-serif;">Link b√†i h·ªçc b·ªã h·ªèng ho·∫∑c ƒëo·∫°n m√£ qu√° l·ªõn. Xin b√°o l·∫°i cho b·ªá h·∫°!</h2>';
            }
        } else {
            applySettings();
        }

        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            if (tabId === 'library') loadLibrary();
        }

        function renderCode() {
            const code = document.getElementById('sourceCode').value;
            document.getElementById('previewFrame').srcdoc = code;
        }

        function saveFlashcard() {
            const code = document.getElementById('sourceCode').value;
            if (!code.trim()) { alert("B·∫©m, ch∆∞a c√≥ m√£ ngu·ªìn!"); return; }
            const title = prompt("T√™n b·ªô Flashcard:", "T·ª´ V·ª±ng Unit M·ªõi");
            if (!title) return;

            let library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
            library.push({ id: Date.now(), title: title, code: code, date: new Date().toLocaleDateString('vi-VN') });
            localStorage.setItem('vocabLibrary', JSON.stringify(library));
            alert("ƒê√£ c·∫•t v√†o Kho T·ª´ V·ª±ng!");
            document.getElementById('sourceCode').value = ''; 
            document.getElementById('previewFrame').srcdoc = '';
        }

        function loadLibrary() {
            const container = document.getElementById('libraryContainer');
            const library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
            if (library.length === 0) {
                container.innerHTML = "<p style='color: #888;'>Kho hi·ªán t·∫°i tr·ªëng r·ªóng.</p>"; return;
            }
            container.innerHTML = library.map(item => `
                <div class="lib-card">
                    <div>
                        <h3>\${item.title}</h3>
                        <div class="date">Ng√†y t·∫°o: \${item.date}</div>
                    </div>
                    <div class="lib-actions">
                        <button class="btn-run" onclick="viewCard(\${item.id})">M·ªü</button>
                        <button class="btn-save" onclick="copyShareLink(\${item.id})">üîó Copy Link</button>
                        <button class="btn-danger" onclick="deleteCard(\${item.id})">X√≥a</button>
                    </div>
                </div>
            `).join('');
        }

        function viewCard(id) {
            const library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
            const card = library.find(c => c.id === id);
            if (card) {
                document.getElementById('modalTitle').innerText = card.title;
                document.getElementById('modalFrame').srcdoc = card.code;
                document.getElementById('previewModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
            document.getElementById('modalFrame').srcdoc = '';
        }

        function deleteCard(id) {
            if (confirm("X√≥a b·ªô n√†y vƒ©nh vi·ªÖn?")) {
                let library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
                library = library.filter(c => c.id !== id);
                localStorage.setItem('vocabLibrary', JSON.stringify(library));
                loadLibrary(); 
            }
        }

        function copyShareLink(id) {
            const library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
            const card = library.find(c => c.id === id);
            if (card) {
                // N√©n to√†n b·ªô m√£ HTML th√†nh ƒë∆∞·ªùng link
                const compressedCode = LZString.compressToEncodedURIComponent(card.code);
                const baseUrl = window.location.href.split('?')[0]; 
                const shareUrl = baseUrl + '?play=' + compressedCode;
                
                // Gi·ªõi h·∫°n an to√†n c·ªßa link th∆∞·ªùng l√† kho·∫£ng 8000 k√Ω t·ª±
                if (shareUrl.length > 8000) {
                    alert("‚ö†Ô∏è C·∫¢NH B√ÅO: ƒêo·∫°n m√£ HTML n√†y qu√° n·∫∑ng (c√≥ th·ªÉ do ch·ª©a nhi·ªÅu th·∫ª SVG ho·∫∑c ·∫£nh Base64). Link c√≥ th·ªÉ s·∫Ω kh√¥ng ho·∫°t ƒë·ªông!");
                }

                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert("ƒê√£ ch√©p link th√†nh c√¥ng!");
                }).catch(() => {
                    alert("Tr√¨nh duy·ªát ch·∫∑n sao ch√©p, b·ªá h·∫° vui l√≤ng copy tay:\n\n" + shareUrl);
                });
            }
        }

        function saveSettings() {
            localStorage.setItem('teacherName', document.getElementById('teacherName').value);
            applySettings();
            alert("ƒê√£ c·∫≠p nh·∫≠t t√™n!");
        }

        function clearAllData() {
            if (confirm("Thi√™u r·ª•i to√†n b·ªô Kho T·ª´ V·ª±ng?")) {
                localStorage.removeItem('vocabLibrary');
                alert("ƒê√£ d·ªçn s·∫°ch!");
                loadLibrary();
            }
        }

        function applySettings() {
            const name = localStorage.getItem('teacherName');
            if (name) {
                document.getElementById('teacherName').value = name;
                document.getElementById('welcomeText').innerText = "Workspace c·ªßa " + name;
            }
        }
    </script>
</body>
</html>
