<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabForge | Workspace</title>
    <style>
        :root {
            --primary: #1a237e; --secondary: #2962ff; --success: #00c853; --danger: #d50000;
            --bg-color: #f0f2f5; --text-main: #333; --sidebar-w: 250px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { display: flex; height: 100vh; background-color: var(--bg-color); color: var(--text-main); overflow: hidden; }
        
        .sidebar { width: var(--sidebar-w); background: #fff; border-right: 1px solid #e0e0e0; padding: 20px; display: flex; flex-direction: column; }
        .brand { font-size: 24px; font-weight: bold; color: var(--primary); margin-bottom: 30px; display: flex; align-items: center; gap: 10px; text-align: center;}
        
        .user-badge { background: #e8eaf6; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 20px; font-weight: bold; color: var(--primary); border: 2px dashed var(--secondary); }
        .badge-student { background: #e0f2f1; color: #00695c; border-color: #00897b; }

        .nav-item { padding: 12px 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: 0.2s; color: #555; }
        .nav-item:hover, .nav-item.active { background: #e8eaf6; color: var(--primary); }
        
        .main-content { flex: 1; display: flex; flex-direction: column; padding: 20px 30px; overflow-y: auto; }
        .header { margin-bottom: 25px; }
        .header h1 { font-size: 28px; color: var(--primary); }
        .header p { color: #666; margin-top: 5px; }
        
        .view-section { display: none; flex-direction: column; height: 100%; }
        .view-section.active { display: flex; }

        /* Workspace Editor */
        .workspace { display: flex; gap: 20px; flex: 1; min-height: 0; }
        .panel { flex: 1; background: #fff; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow: hidden; }
        .panel-header { background: #fafafa; padding: 15px 20px; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .panel-actions { display: flex; gap: 10px; }
        textarea { flex: 1; width: 100%; border: none; padding: 20px; font-family: 'Consolas', monospace; font-size: 14px; color: #333; resize: none; outline: none; background: #fafafa; }
        
        /* Buttons */
        button { border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; color: white; }
        .btn-run { background: var(--secondary); } .btn-run:hover { background: #1c44b2; }
        .btn-save { background: var(--success); } .btn-save:hover { background: #009624; }
        .btn-danger { background: var(--danger); } .btn-danger:hover { background: #9b0000; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }
        
        iframe { width: 100%; height: 100%; border: none; background: #fff; }

        /* Library */
        .library-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .lib-card { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; height: 160px;}
        .lib-card h3 { color: var(--primary); margin-bottom: 10px; font-size: 18px; }
        .lib-card .date { font-size: 12px; color: #888; margin-bottom: 15px; }
        .lib-actions { display: flex; gap: 8px; }
        .lib-actions button { flex: 1; padding: 10px 5px; font-size: 14px; }

        /* Settings Dashboard */
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 900px; }
        .settings-card { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .settings-card h3 { margin-bottom: 15px; color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 10px;}
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
        .role-switch { display: flex; gap: 10px; margin-bottom: 20px; }
        .role-switch button { flex: 1; padding: 12px; font-size: 16px; }

        /* Modal Preview */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; width: 95%; max-width: 900px; height: 85vh; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { padding: 15px 20px; background: #fafafa; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .btn-close { background: #ccc; color: #333; font-size: 16px; padding: 8px 20px;}
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="brand">üéì VocabForge</div>
        
        <div id="userBadge" class="user-badge">üë®‚Äçüè´ Ch·∫ø ƒë·ªô: Gi√°o Vi√™n</div>

        <div class="nav-item" id="nav-creator" onclick="switchTab('creator')">‚ö° Tr√¨nh T·∫°o Flashcard</div>
        <div class="nav-item active" id="nav-library" onclick="switchTab('library')">üìö Kho T·ª´ V·ª±ng</div>
        <div class="nav-item" id="nav-settings" onclick="switchTab('settings')">‚öôÔ∏è C√†i ƒê·∫∑t Kh√¥ng Gian</div>
    </aside>

    <main class="main-content">
        <div id="view-creator" class="view-section">
            <div class="header">
                <h1>Workspace - Tr√¨nh So·∫°n Th·∫£o</h1>
                <p>N∆°i b·ªá h·∫° d√°n m√£ HTML/Tailwind ƒë·ªÉ r√®n ƒë√∫c Flashcard m·ªõi.</p>
            </div>
            <div class="workspace">
                <div class="panel">
                    <div class="panel-header">
                        <span>üíª HTML Editor</span>
                        <div class="panel-actions">
                            <button class="btn-run" onclick="renderCode()">Ch·∫°y Th·ª≠ ‚ñ∂</button>
                            <button class="btn-save" onclick="saveFlashcard()">üíæ C·∫•t v√†o Kho</button>
                        </div>
                    </div>
                    <textarea id="sourceCode" placeholder=""></textarea>
                </div>
                <div class="panel">
                    <div class="panel-header"><span>üì± Live Preview</span></div>
                    <iframe id="previewFrame" sandbox="allow-scripts"></iframe>
                </div>
            </div>
        </div>

        <div id="view-library" class="view-section active">
            <div class="header">
                <h1 id="libraryTitle">üìö Kho B√†i H·ªçc</h1>
                <p>Ch·ªçn m·ªôt b·ªô th·∫ª b√™n d∆∞·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu √¥n luy·ªán.</p>
            </div>
            <div class="library-grid" id="libraryContainer"></div>
        </div>

        <div id="view-settings" class="view-section">
            <div class="header">
                <h1>‚öôÔ∏è Qu·∫£n Tr·ªã H·ªá Th·ªëng</h1>
                <p>T√πy ch·ªânh vai tr√≤, b·∫£o m·∫≠t v√† sao l∆∞u d·ªØ li·ªáu l·ªõp h·ªçc.</p>
            </div>
            
            <div class="settings-grid">
                <div class="settings-card">
                    <h3>üé≠ Chuy·ªÉn ƒê·ªïi Vai Tr√≤</h3>
                    <p style="margin-bottom: 15px; color: #666; font-size: 14px;">Chuy·ªÉn sang "H·ªçc Sinh" ƒë·ªÉ ·∫©n c√¥ng c·ª• ch·ªânh s·ª≠a, t·∫°o m√¥i tr∆∞·ªùng h·ªçc t·∫≠p an to√†n.</p>
                    <div class="role-switch">
                        <button class="btn-run" onclick="changeRole('teacher')">üë®‚Äçüè´ Gi√°o Vi√™n</button>
                        <button class="btn-save" onclick="changeRole('student')">üë®‚Äçüéì H·ªçc Sinh</button>
                    </div>
                    
                    <div class="form-group" id="pinSetupGroup">
                        <label>Thi·∫øt l·∫≠p m√£ PIN Gi√°o Vi√™n:</label>
                        <input type="password" id="teacherPin" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng c·∫ßn b·∫£o m·∫≠t...">
                        <button class="btn-outline" onclick="savePin()" style="width: 100%; margin-top: 10px;">L∆∞u m√£ PIN</button>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>üì¶ ƒê·ªìng B·ªô D·ªØ Li·ªáu (Kh√¥ng c·∫ßn m·∫°ng)</h3>
                    <p style="margin-bottom: 15px; color: #666; font-size: 14px;">Gi√°o vi√™n t·∫£i File D·ªØ Li·ªáu xu·ªëng, g·ª≠i cho H·ªçc sinh. H·ªçc sinh t·∫£i File ƒë√≥ l√™n ƒë·ªÉ ƒë·ªìng b·ªô kho b√†i h·ªçc.</p>
                    
                    <button class="btn-run" onclick="exportData()" style="width: 100%; margin-bottom: 15px;">üì• Xu·∫•t File D·ªØ Li·ªáu (G·ª≠i cho tr√≤)</button>
                    
                    <div style="position: relative; overflow: hidden; display: inline-block; width: 100%;">
                        <button class="btn-outline" style="width: 100%;">üì§ Nh·∫≠p File D·ªØ Li·ªáu (H·ªçc sinh ·∫•n v√†o ƒë√¢y)</button>
                        <input type="file" id="importFile" accept=".vocab, .json" onchange="importData(event)" style="position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; width: 100%;">
                    </div>

                    <hr style="border: 0; border-top: 1px dashed #ccc; margin: 20px 0;">
                    <button class="btn-danger" id="btnWipeData" onclick="clearAllData()" style="width: 100%;">üî• X√≥a To√†n B·ªô Kho D·ªØ Li·ªáu</button>
                </div>
            </div>
        </div>
    </main>

    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Xem Flashcard</h3>
                <button class="btn-close" onclick="closeModal()">ƒê√≥ng ‚úñ</button>
            </div>
            <iframe id="modalFrame" sandbox="allow-scripts" style="flex:1;"></iframe>
        </div>
    </div>

    <script>
        // --- 1. H·ªÜ TH·ªêNG PH√ÇN QUY·ªÄN (ROLE MANAGEMENT) ---
        function applyRole() {
            const role = localStorage.getItem('userRole') || 'teacher';
            const badge = document.getElementById('userBadge');
            const navCreator = document.getElementById('nav-creator');
            const btnWipe = document.getElementById('btnWipeData');
            const pinGroup = document.getElementById('pinSetupGroup');

            if (role === 'student') {
                badge.className = 'user-badge badge-student';
                badge.innerText = 'üë®‚Äçüéì Ch·∫ø ƒë·ªô: H·ªçc Sinh';
                navCreator.style.display = 'none'; // Gi·∫•u Tr√¨nh T·∫°o Flashcard
                btnWipe.style.display = 'none'; // H·ªçc sinh kh√¥ng ƒë∆∞·ª£c x√≥a kho
                pinGroup.style.display = 'none'; // H·ªçc sinh kh√¥ng ƒë∆∞·ª£c ƒë·ªïi PIN
                
                // √âp v·ªÅ trang Kho T·ª´ V·ª±ng n·∫øu ƒëang ·ªü Tr√¨nh T·∫°o
                if (document.getElementById('view-creator').classList.contains('active')) {
                    switchTab('library');
                }
            } else {
                badge.className = 'user-badge';
                badge.innerText = 'üë®‚Äçüè´ Ch·∫ø ƒë·ªô: Gi√°o Vi√™n';
                navCreator.style.display = 'block';
                btnWipe.style.display = 'block';
                pinGroup.style.display = 'block';
            }
            
            // Render l·∫°i Kho T·ª´ V·ª±ng ƒë·ªÉ ·∫©n/hi·ªán n√∫t X√≥a
            loadLibrary();
        }

        function changeRole(newRole) {
            const currentRole = localStorage.getItem('userRole') || 'teacher';
            
            // N·∫øu t·ª´ H·ªçc Sinh mu·ªën l√™n Gi√°o Vi√™n -> B·∫Øt nh·∫≠p m√£ PIN
            if (currentRole === 'student' && newRole === 'teacher') {
                const savedPin = localStorage.getItem('teacherPin');
                if (savedPin) {
                    const enteredPin = prompt("Vui l√≤ng nh·∫≠p m√£ PIN c·ªßa Th·∫ßy Th·ªãnh:");
                    if (enteredPin !== savedPin) {
                        alert("‚ùå Sai m√£ PIN! K·∫ª gian kh√¥ng ƒë∆∞·ª£c v√†o ng·ª± th∆∞ ph√≤ng!");
                        return;
                    }
                }
            }

            localStorage.setItem('userRole', newRole);
            applyRole();
            alert(newRole === 'teacher' ? "ƒê√£ c·∫•p quy·ªÅn Gi√°o Vi√™n!" : "ƒê√£ chuy·ªÉn sang g√≥c ƒë·ªô H·ªçc Sinh!");
            switchTab('library');
        }

        function savePin() {
            const pin = document.getElementById('teacherPin').value;
            localStorage.setItem('teacherPin', pin);
            alert("ƒê√£ l∆∞u m√£ PIN an to√†n!");
            document.getElementById('teacherPin').value = '';
        }

        // --- 2. ƒêI·ªÄU H∆Ø·ªöNG & GIAO DI·ªÜN ---
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(function(el) { el.classList.remove('active'); });
            document.querySelectorAll('.nav-item').forEach(function(el) { el.classList.remove('active'); });
            
            document.getElementById('view-' + tabId).classList.add('active');
            document.getElementById('nav-' + tabId).classList.add('active');
            
            if (tabId === 'library') loadLibrary();
        }

        // --- 3. LOGIC FLASHCARD (D√†nh cho Gi√°o vi√™n) ---
        function renderCode() {
            document.getElementById('previewFrame').srcdoc = document.getElementById('sourceCode').value;
        }

        function saveFlashcard() {
            const code = document.getElementById('sourceCode').value;
            if (!code.trim()) { alert("B·∫©m, ch∆∞a c√≥ m√£ ngu·ªìn!"); return; }
            const title = prompt("Ban t√™n cho b·ªô Flashcard n√†y:", "T·ª´ V·ª±ng Unit M·ªõi");
            if (!title) return;

            let library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
            library.push({ id: Date.now(), title: title, code: code, date: new Date().toLocaleDateString('vi-VN') });
            localStorage.setItem('vocabLibrary', JSON.stringify(library));
            
            alert("ƒê√£ c·∫•t v√†o Kho an to√†n!");
            document.getElementById('sourceCode').value = ''; 
            document.getElementById('previewFrame').srcdoc = '';
        }

        // --- 4. HI·ªÇN TH·ªä KHO T·ª™ V·ª∞NG T√ôY THEO VAI TR√í ---
        function loadLibrary() {
            const container = document.getElementById('libraryContainer');
            const library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
            const role = localStorage.getItem('userRole') || 'teacher';

            if (library.length === 0) {
                container.innerHTML = "<p style='color: #888; padding: 20px;'>Kho b√†i h·ªçc ƒëang tr·ªëng.</p>"; return;
            }
            
            let htmlContent = '';
            for (let i = 0; i < library.length; i++) {
                const item = library[i];
                htmlContent += '<div class="lib-card">' +
                    '<div>' +
                        '<h3>' + item.title + '</h3>' +
                        '<div class="date">C·∫≠p nh·∫≠t: ' + item.date + '</div>' +
                    '</div>' +
                    '<div class="lib-actions">' +
                        '<button class="btn-run" onclick="viewCard(' + item.id + ')" style="font-size: 16px;">‚ñ∂ M·ªü H·ªçc Ngay</button>';
                
                // CH·ªà GI√ÅO VI√äN M·ªöI TH·∫§Y N√öT X√ìA
                if (role === 'teacher') {
                    htmlContent += '<button class="btn-danger" onclick="deleteCard(' + item.id + ')" style="flex: 0.3;">X√≥a</button>';
                }
                
                htmlContent += '</div></div>';
            }
            container.innerHTML = htmlContent;
        }

        function viewCard(id) {
            const library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
            let card = null;
            for(let i=0; i<library.length; i++) { if(library[i].id === id) { card = library[i]; break; } }
            if (card) {
                document.getElementById('modalTitle').innerText = card.title;
                document.getElementById('modalFrame').srcdoc = card.code;
                document.getElementById('previewModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
            document.getElementById('modalFrame').srcdoc = '';
        }

        function deleteCard(id) {
            if (confirm("X√≥a b·ªô th·∫ª n√†y vƒ©nh vi·ªÖn kh·ªèi Kho?")) {
                let library = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
                let newLibrary = [];
                for(let i=0; i<library.length; i++) { if(library[i].id !== id) { newLibrary.push(library[i]); } }
                localStorage.setItem('vocabLibrary', JSON.stringify(newLibrary));
                loadLibrary(); 
            }
        }

        // --- 5. ƒê·ªíNG B·ªò D·ªÆ LI·ªÜU (EXPORT / IMPORT) ---
        function exportData() {
            const library = localStorage.getItem('vocabLibrary');
            if (!library || library === '[]') {
                alert("Kho ƒëang tr·ªëng, kh√¥ng c√≥ g√¨ ƒë·ªÉ xu·∫•t b·∫©m b·ªá h·∫°!"); return;
            }
            
            // T·∫°o file .vocab (th·ª±c ch·∫•t l√† chu·ªói JSON)
            const blob = new Blob([library], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `DuLieuLopHoc_${new Date().getTime()}.vocab`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                        // H·ªèi xem mu·ªën Ghi ƒê√® hay G·ªôp chung
                        const merge = confirm("B·∫•m OK ƒë·ªÉ 'G·ªôp chung' d·ªØ li·ªáu m·ªõi v√†o kho c≈©.\nB·∫•m Cancel ƒë·ªÉ 'X√≥a kho c≈©, ch·ªâ l·∫•y d·ªØ li·ªáu m·ªõi'.");
                        if (merge) {
                            const currentLibrary = JSON.parse(localStorage.getItem('vocabLibrary')) || [];
                            const combined = currentLibrary.concat(importedData);
                            localStorage.setItem('vocabLibrary', JSON.stringify(combined));
                        } else {
                            localStorage.setItem('vocabLibrary', JSON.stringify(importedData));
                        }
                        alert("üéâ Nh·∫≠p d·ªØ li·ªáu th√†nh c√¥ng! M·ªùi h·ªçc tr√≤ v√†o Kho ƒë·ªÉ h·ªçc.");
                        switchTab('library');
                    } else {
                        throw new Error("Sai ƒë·ªãnh d·∫°ng");
                    }
                } catch (err) {
                    alert("‚ùå File d·ªØ li·ªáu b·ªã h·ªèng ho·∫∑c kh√¥ng ƒë√∫ng chu·∫©n VocabForge!");
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Reset input
        }

        function clearAllData() {
            if (confirm("C·∫¢NH B√ÅO: Thao t√°c n√†y s·∫Ω thi√™u r·ª•i to√†n b·ªô d·ªØ li·ªáu. B·ªá h·∫° c√≥ ch·∫Øc ch·∫Øn?")) {
                localStorage.removeItem('vocabLibrary');
                alert("ƒê√£ d·ªçn s·∫°ch kho!");
                loadLibrary();
            }
        }

        // Kh·ªüi ƒë·ªông
        applyRole();
        loadLibrary();
    </script>
</body>
</html>
